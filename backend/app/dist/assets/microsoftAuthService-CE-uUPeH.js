const c="http://localhost:8000/";class d{constructor(){this.popup=null,this.popupCheckInterval=null}async initiateMicrosoftLogin(){try{const t=await fetch(`${c}api/v1/auth/microsoft/login`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Failed to initiate Microsoft login")}const{auth_url:s,state:o}=await t.json();return await this.openLoginPopup(s,o)}catch(t){throw console.error("❌ Microsoft login initiation failed:",t),t}}async openLoginPopup(t,s){return new Promise((o,e)=>{const l=window.screen.width/2-300,h=window.screen.height/2-700/2;if(this.popup=window.open(t,"Microsoft Login",`width=600,height=700,left=${l},top=${h},toolbar=no,menubar=no,location=no,status=no`),!this.popup){e(new Error("Popup blocked. Please allow popups for this site and try again."));return}this.popupCheckInterval=setInterval(()=>{try{if(!this.popup||this.popup.closed){clearInterval(this.popupCheckInterval),e(new Error("Login cancelled by user"));return}const r=this.popup.location.href;if(r.includes("/auth/microsoft/success")){clearInterval(this.popupCheckInterval);const i=new URL(r),n=i.searchParams.get("token"),p=i.searchParams.get("user");if(n&&p){const u=JSON.parse(decodeURIComponent(p));this.popup.close(),this.popup=null,o({token:n,user:u})}else this.popup.close(),this.popup=null,e(new Error("Invalid callback parameters"))}if(r.includes("/login?error=")){clearInterval(this.popupCheckInterval);const n=new URL(r).searchParams.get("error");this.popup.close(),this.popup=null,e(new Error(decodeURIComponent(n)))}}catch{}},500)})}async silentSSOLogin(t,s){try{const o=await fetch(`${c}api/v1/auth/microsoft/silent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:t,email:s.email,microsoft_id:s.microsoft_id,first_name:s.first_name,last_name:s.last_name})});if(!o.ok){const a=await o.json();throw new Error(a.detail||"Silent SSO failed")}const e=await o.json();return{token:e.access_token,user:e.user}}catch(o){throw console.error("❌ Silent SSO failed:",o),o}}shouldAttemptSharePointSSO(){return new URLSearchParams(window.location.search).get("sso")==="auto"}cancel(){this.popupCheckInterval&&(clearInterval(this.popupCheckInterval),this.popupCheckInterval=null),this.popup&&!this.popup.closed&&(this.popup.close(),this.popup=null)}}const m=new d;export{m as default,m as microsoftAuthService};
//# sourceMappingURL=microsoftAuthService-CE-uUPeH.js.map
